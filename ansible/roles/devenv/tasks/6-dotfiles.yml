- name: Install packages
  apt:
    name: "{{ item }}"
    state: present
    update_cache: yes
    cache_valid_time: 3600
  with_items:
    - zsh
    - direnv
    - zsh-syntax-highlighting

# git clone https://github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions
- name: Install zsh-autosuggestions
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions
    dest: "/usr/local/share/zsh-autosuggestions"

- name: Set custom_username to use zsh
  user:
    name: "{{ custom_username }}"
    shell: /bin/zsh

- name: Install diff-so-fancy
  copy:
    src: "diff-so-fancy"
    dest: "/usr/local/bin/diff-so-fancy"
    owner: root
    group: root
    mode: '0755'


- name: Checkout personal dotfiles repo
  git:
    repo: https://github.com/danrabinowitz/dotfiles.git
    dest: "/home/{{ custom_username }}/.dotfiles.git"
- name: Set ownership of dotfiles
  file:
    path: "/home/{{ custom_username }}/.dotfiles.git"
    state: directory
    recurse: yes
    owner: "{{ custom_username }}"
    group: "{{ custom_username }}"

- name: Create .dotfiles
  file:
    src: ".dotfiles.git"
    dest: "/home/{{ custom_username }}/.dotfiles"
    state: link
- name: Create Config
  file:
    src: ".dotfiles.git"
    dest: "/home/{{ custom_username }}/Config"
    state: link

- name: Create symbolic links for dotfiles
  file:
    src: ".dotfiles.git/dot.{{ item }}"
    dest: "/home/{{ custom_username }}/.{{ item }}"
    state: link
    force: yes
  with_items:
    - bash_profile
    - bashrc
    - dircolors
    - emacs
    - emacs.d
    - gitconfig
    - irbrc
    - profile
    - profile_interactive
    - inputrc
    - tmux.conf
    - psqlrc
    - my.cnf
    - gitignore_global
    - zshrc
    - gemrc
    - rspec
    - railsrc
